apiVersion: v1
kind: Secret
metadata:
  name: alertmanager-custom-config
  namespace: monitoring-production
  labels:
    app: kube-prometheus-stack-alertmanager
type: Opaque
stringData:
  alertmanager.yaml: |
    global:
      resolve_timeout: 5m

    templates:
      - '/etc/alertmanager/config/discord.tmpl'
      
    route:
      receiver: discord
      group_by: ['alertname']
      group_wait: 10s
      group_interval: 5m
      repeat_interval: 1h

    receivers:
      - name: discord
        webhook_configs:
          - url: 'https://discord.com/api/webhooks/1245666301259550720/VcDYTXkOw8Z8W6MbxTrIXYBQmM8l5oZAm_e7-5bU-h7w0kNKci8q3Zo7Cl7NPrEF6Hp2'
            send_resolved: true
            http_config:
              headers:
                Content-Type: application/json
            template: "discord.message"
