apiVersion: v1
kind: Secret
metadata:
  name: alertmanager-custom-config
  namespace: monitor
type: Opaque
stringData:
  alertmanager.yaml: |
    global:
      resolve_timeout: 5m

    route:
      receiver: discord
      group_by: ['alertname']
      group_wait: 10s
      group_interval: 30s
      repeat_interval: 1h

    receivers:
      - name: discord
        discord_configs:
          - webhook_url: 'https://discord.com/api/webhooks/1245666301259550720/VcDYTXkOw8Z8W6MbxTrIXYBQmM8l5oZAm_e7-5bU-h7w0kNKci8q3Zo7Cl7NPrEF6Hp2'
            message: '{{ template "discord.default.message" . }}'

    templates:
      - '/etc/alertmanager/config/discord.tmpl'
  discord.tmpl: | 
    {{ define "discord.default.message" }}
    **Alert:** {{ .CommonLabels.alertname }}
    **Status:** {{ .Status }}   **Severity:** {{ .CommonLabels.severity }}

    **Summary:** {{ .CommonAnnotations.summary }}
    **Description:** {{ .CommonAnnotations.description }}

    **Labels:**
    {{ range .CommonLabels.SortedPairs }}
    â€¢ **{{ .Name }}** = `{{ .Value }}`
    {{ end }}
    {{ end }}